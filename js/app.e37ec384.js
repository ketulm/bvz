(function(t){function e(e){for(var n,s,c=e[0],o=e[1],l=e[2],d=0,u=[];d<c.length;d++)s=c[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&u.push(i[s][0]),i[s]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);h&&h(e);while(u.length)u.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],n=!0,c=1;c<a.length;c++){var o=a[c];0!==i[o]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},i={app:0},r=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/bvz/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=o;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"0f19":function(t,e,a){"use strict";var n=a("b43f"),i=a.n(n);i.a},"0f1a":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("header",{staticClass:"header"},[a("h1",{staticClass:"title"},[t._v(" Boston Traffic Incidents "),a("span",{staticClass:"subtitle"},[t._v(t._s(t.yearsTitle))])]),1!=t.isLoading?a("nav",{staticClass:"header--navigation is-right"},[a("b-field",[a("b-radio-button",{attrs:{size:"is-small","native-value":"*",title:"Show all incident types"},model:{value:t.incidentType,callback:function(e){t.incidentType=e},expression:"incidentType"}},[a("span",[t._v("All")])]),a("b-radio-button",{attrs:{size:"is-small","native-value":"mv",title:"Show incidents involving motor vehicles"},model:{value:t.incidentType,callback:function(e){t.incidentType=e},expression:"incidentType"}},[a("b-icon",{attrs:{icon:"car",pack:"mdi",size:"is-small"}}),a("span",[t._v("Motor vehicle")])],1),a("b-radio-button",{attrs:{size:"is-small","native-value":"bike",title:"Show incidents involving bikes"},model:{value:t.incidentType,callback:function(e){t.incidentType=e},expression:"incidentType"}},[a("b-icon",{attrs:{icon:"bike",pack:"mdi",size:"is-small"}}),a("span",[t._v("Bike")])],1),a("b-radio-button",{attrs:{size:"is-small","native-value":"ped",title:"Show incidents involving pedestrians"},model:{value:t.incidentType,callback:function(e){t.incidentType=e},expression:"incidentType"}},[a("b-icon",{attrs:{icon:"walk",pack:"mdi",size:"is-small"}}),a("span",[t._v("Pedestrian")])],1)],1)],1):t._e()]),a("section",{directives:[{name:"show",rawName:"v-show",value:1!=t.isLoading,expression:"isLoading != true"}],staticClass:"vis"},[a("geo-heatmap",{attrs:{neighborhoods:t.neighborhoods,stations:t.stations,allIncidents:t.incidents,allSummary:t.incidentsSummary,year:t.year,month:t.month,incidentType:t.incidentType}})],1),a("div",{staticClass:"app--footer"},[t._v("Â© 2020 Ketul Mavani")])])},r=[],s=(a("a4d3"),a("99af"),a("4de4"),a("4160"),a("d81d"),a("dca8"),a("e439"),a("dbb4"),a("b64b"),a("d3b7"),a("07ac"),a("6062"),a("3ca3"),a("159b"),a("ddb0"),a("ade3")),c=a("2909"),o=(a("96cf"),a("1da1")),l=a("bc3a"),h=a.n(l),d="/bvz/data/Boston_Neighborhoods.geojson",u="/bvz/data/Boston_Police_Stations.geojson",p="/bvz/data/vision_zero_ss.json",f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mapvis--container"},[a("div",{ref:"mapvis",staticClass:"mapvis"},[t.numBoxSelectedIncidents>0?a("div",{staticClass:"mapvis--title subtitle"},[t._v(" "+t._s(t.numBoxSelectedIncidents)+" incidents ")]):t._e(),a("svg",{ref:"mapSvg",staticClass:"mapvis--svg",attrs:{height:t.height,width:t.width-t.rightClip}}),a("canvas",{ref:"mapCanvas",staticClass:"mapvis--canvas",attrs:{height:t.height,width:t.width-t.rightClip}}),a("svg",{ref:"mapSvgSelection",staticClass:"mapvis--canvas__selection mapvis--canvas__selectionsvg",attrs:{height:t.height,width:t.width-t.rightClip}}),a("canvas",{ref:"mapCanvasSelection",staticClass:"mapvis--canvas__selection",attrs:{height:t.height,width:t.width-t.rightClip}})]),a("div",{staticClass:"sumvis--container"},[a("heatmap",{attrs:{allIncidents:t.allIncidents,boxSelectedIncidents:t.boxSelectedIncidents,incidentType:t.incidentType,allSummary:t.allSummary},on:{selected:t.updateSelection}})],1)])},m=[],y=(a("b0c0"),a("3835")),g=a("5698"),v=(a("6b85"),a("3fe2"),a("6ebf")),b=a.n(v),x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"heatmap",staticClass:"heatmap"},[a("div",{staticClass:"heatmap--vis"},[a("div",{staticClass:"heatmap--svg-container is-flex"},[a("svg",{ref:"heatmapSvg",staticClass:"heatmap--svg",attrs:{height:t.chartHeight,width:t.chartWidth}}),a("barchart",{attrs:{type:"months",vertical:!1,margin:t.margin,chartData:t.stats.month,barHeight:t.barHeight,barWidth:t.cellHeight,chartHeight:t.chartWidth,selected:t.selected}}),a("div",{staticClass:"selection--subtitle has-text-right",style:{"padding-right":t.margin.right+"px"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.selected.incidents>0,expression:"selected.incidents > 0"}]},[t._v(" "+t._s(t.selected.incidents)+" incidents selected ")])])],1),a("div",{staticClass:"heatmap--right-container"},[a("barchart",{attrs:{type:"hours",vertical:!0,margin:t.margin,chartData:t.stats.hour,barHeight:t.cellHeight,barWidth:t.barHeight,chartHeight:t.chartHeight,selected:t.selected}}),a("svg",{ref:"heatmapLegend",staticClass:"heatmap--legendsvg",attrs:{height:t.chartHeight,width:t.legendWidth+t.legendMargin.left}})],1)]),a("div",{staticClass:"sumvis--summary"},[a("stackedbar",{attrs:{chartData:t.allSummary.yearly,width:170,height:220,title:"All"}}),a("article",{staticClass:"sumvis--description is-half"},[a("p",[t._v(" Vision Zero is a multi-national initiative that aims to eliminate serious or fatal traffic incidents by 2030. This visualization shows all the serious incidents that occurred in Boston, MA "+t._s(t.yearRange)+" using the data provided by "),a("a",{attrs:{href:"https://data.boston.gov/dataset/vision-zero-crash-records"}},[t._v("data.boston.gov")]),t._v(". ")]),a("br"),a("p",[t._v(" This interactive visualization capability shows geographic and temporal hotspots where many of these incidents occur. ")]),a("br"),a("p",[t._v(" Using the incident type filter, places where serious incidents involving pedestrian or bicycle can be focused on. Using the calendar chart, incidents that occure at certain hour, in certain month, or at certain hour across all years can be highlighted in the map view. ")]),a("br")])],1)])},_=[],k=(a("0481"),a("4069"),["12 am","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","12 pm","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"]),w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],S=(a("ac1f"),a("5319"),{toggleSpinner:function(t){var e=t.getElementsByClassName("fa")[0]||t;e&&(e.classList.contains("fa-pulse")&&e.classList.contains("fa-spinner")?(e.classList.remove("fa-pulse"),e.classList.replace("fa-spinner","fa-refresh")):e.classList.contains("fa-refresh")&&(e.classList.replace("fa-refresh","fa-spinner"),e.classList.add("fa-pulse")))},scaleColor:function(t){return g["c"](g["g"](1-t)).hex()},scaleColorSelection:function(t){return g["c"](g["h"](1-t)).hex()}}),C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("svg",{ref:"barchart",staticClass:"barchart",attrs:{height:t.height,width:t.width}})},H=[],A={name:"Barchart",props:["margin","chartData","selected","vertical","type","barHeight","barWidth","chartHeight"],data:function(){return{barsData:void 0,min:1,max:1}},computed:{height:function(){return this.vertical?this.chartHeight:this.barHeight},width:function(){return this.vertical?this.barWidth:this.chartHeight}},watch:{chartData:{deep:!0,handler:function(){if(null!=this.chartData.totals&&(this.barsData=this.chartData.totals,null!=this.barsData&&0!=this.barsData.length)){g["r"](this.$refs.barchart).selectAll("*").remove();var t=this.chartData.totals.map((function(t){return t.total}));this.min=g["j"](t),this.max=g["i"](t),"months"==this.type?this.updateBarChartHorizontal():this.updateBarChartVertical()}}},selected:{deep:!0,handler:function(){var t=g["r"](this.$refs.barchart);t.selectAll(".barchart__selected").classed("barchart__selected",!1),"month"==this.selected.type&&t.selectAll(".month-".concat(this.selected.month,".year-").concat(this.selected.year)).classed("barchart__selected",!0),"hour"==this.selected.type&&t.selectAll(".hour-".concat(this.selected.hour)).classed("barchart__selected",!0)}}},methods:{updateBarChartHorizontal:function(){var t=this,e=g["r"](this.$refs.barchart),a=e.append("g");a.attr("transform","translate(".concat(this.margin.left,", 0)")),a.append("g").selectAll(".barchart__bars").data(this.barsData).enter().append("rect").attr("class",(function(t){return"barchart__bars"})).attr("x",(function(e,a){return a*t.barWidth})).attr("y",0).attr("height",(function(e,a){return t.barHeight*(e.total/t.max)})).attr("width",this.barWidth).attr("stroke","none").attr("stroke-width","0").attr("fill",(function(e,a){e.total,t.max;return S.scaleColor(.2)})).attr("opacity",.6).append("title").text((function(t){return"".concat(t.total," incidents, ").concat(t.key)})),a.append("g").selectAll(".barchart__ticks").data(this.barsData).enter().append("rect").attr("class",(function(t){return"".concat(t.class," barchart__ticks")})).attr("x",(function(e,a){return a*t.barWidth})).attr("y",(function(e,a){return t.barHeight*(e.total/t.max)-1.5})).attr("height",1.5).attr("width",this.barWidth).attr("stroke","none").attr("stroke-width","0").attr("fill",(function(e,a){e.total,t.max;return S.scaleColor(.6)}))},updateBarChartVertical:function(){var t=this,e=g["r"](this.$refs.barchart),a=e.append("g");a.attr("transform","translate(0,".concat(this.margin.top,")")),a.append("g").selectAll(".barchart__bars").data(this.barsData).enter().append("rect").attr("class",(function(t){return"barchart__bars"})).attr("x",0).attr("y",(function(e,a){return a*t.barHeight})).attr("height",this.barHeight).attr("width",(function(e,a){return t.barWidth*(e.total/t.max)})).attr("stroke","none").attr("stroke-width","0").attr("fill",(function(e,a){e.total,t.max;return S.scaleColor(.2)})).attr("opacity",.6).append("title").text((function(t){return"".concat(t.total," incidents at ").concat(t.key)})),a.append("g").selectAll(".barchart__ticks").data(this.barsData).enter().append("rect").attr("class",(function(t){return"".concat(t.class," barchart__ticks")})).attr("x",(function(e,a){return t.barWidth*(e.total/t.max)-1.5})).attr("y",(function(e,a){return a*t.barHeight})).attr("height",this.barHeight).attr("width",1.5).attr("stroke","none").attr("stroke-width","0").attr("fill",(function(e,a){e.total,t.max;return S.scaleColor(.6)}))}}},j=A,O=(a("aa1c"),a("2877")),D=Object(O["a"])(j,C,H,!1,null,null,null),I=D.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"stackedbar--container"},[a("div",{staticClass:"stackedbar--title"}),a("svg",{ref:"stackedbar",staticClass:"stackedbar",attrs:{height:t.chartHeight,width:t.chartWidth}})])},$=[],z=(a("a15b"),{name:"stackedbar",props:["chartData","selected","width","height","title"],data:function(){return{margin:{bottom:30,top:10,left:10,right:10}}},computed:{chartHeight:function(){return+this.height+this.margin.top+this.margin.bottom},chartWidth:function(){return+this.width+this.margin.left+this.margin.right}},watch:{chartData:{deep:!0,handler:function(){this.updateBarChart(),console.log(this.chartData)}}},methods:{updateBarChart:function(){var t=this,e=g["r"](this.$refs.stackedbar),a=e.append("g").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.top,")")),n=g["s"]().keys(this.chartData.columns)(this.chartData).map((function(t){return t.forEach((function(e){return e.key=t.key})),t})),i=g["n"]().domain(this.chartData.map((function(t){return t.name}))).range([this.margin.left,this.width-this.margin.right]).padding(.1),r=g["o"]().domain([0,g["i"](n,(function(t){return g["i"](t,(function(t){return t[1]}))}))]).rangeRound([this.height-this.margin.bottom,this.margin.top]),s=g["p"]().range([S.scaleColor(.3),S.scaleColor(.4),S.scaleColor(.5)]).domain(this.chartData.columns),c=a.append("g").selectAll("g").data(n);c.join("g").attr("stroke",(function(t){return s(t.key)})).attr("stroke-width",".5").attr("fill",(function(t){return s(t.key)})).attr("opacity",.5).selectAll("rect").data((function(t){return t})).join("rect").attr("x",(function(t,e){return i(t.data.name)})).attr("y",(function(t,e){return r(t[1])})).attr("height",(function(t){return r(t[0])-r(t[1])})).attr("width",i.bandwidth()).append("title").text((function(e){console.log(e);var a=e[1]-e[0],n=t.chartData.titles[e.key];return"".concat(a," ").concat(n," incidents in ").concat(e.data.name)}));var o=e.append("g").attr("transform","translate(".concat(this.margin.left,",").concat(this.height-this.margin.top,")")).call(g["a"](i).tickSizeOuter(0));o.selectAll("line").remove(),o.selectAll("path").remove(),o.selectAll("text").attr("alignment-baseline","middle").style("text-anchor","end").style("font-size","14px").style("font-family","Montserrat").style("font-weight","100").attr("dy","-7px").style("user-select","none").attr("transform","rotate(-90)");a.append("g").selectAll(".bar--label").data(this.chartData).enter().append("text").attr("class","bar--label").attr("y",(function(t){return r(t.total)-10})).attr("x",(function(t){return i(t.name)})).style("font-size","12px").style("font-family","Montserrat").style("font-weight","100").attr("fill",S.scaleColor(.7)).attr("opacity",.5).text((function(t){return t.total}))},updateBarChartH:function(){var t=g["r"](this.$refs.stackedbar),e=t.append("g").attr("transform","translate(".concat(this.margin.left,", ").concat(this.margin.top,")")),a=g["s"]().keys(this.chartData.columns)(this.chartData).map((function(t){return t.forEach((function(e){return e.key=t.key})),t})),n=g["o"]().domain([0,g["i"](a,(function(t){return g["i"](t,(function(t){return t[1]}))}))]).rangeRound([this.width-this.margin.left,this.margin.right]),i=g["n"]().domain(this.chartData.map((function(t){return t.name}))).range([this.margin.top,this.height-this.margin.bottom]).padding(.1),r=g["p"]().range([S.scaleColor(.3),S.scaleColor(.4),S.scaleColor(.5)]).domain(this.chartData.columns);e.append("g").selectAll("g").data(a).join("g").attr("stroke",(function(t){return r(t.key)})).attr("stroke-width",".5").attr("fill",(function(t){return r(t.key)})).attr("opacity",.5).selectAll("rect").data((function(t){return t})).join("rect").attr("x",(function(t,e){return n(t[1])})).attr("y",(function(t,e){return i(t.data.name)})).attr("width",(function(t){return n(t[0])-n(t[1])})).attr("height",i.bandwidth()).append("title").text((function(t){return"".concat(t.data.name," ").concat(t.key)}));var s=t.append("g").attr("transform","translate(".concat(this.margin.left,",").concat(this.height-this.margin.top,")")).call(g["b"](i).tickSizeOuter(0));s.selectAll("line").remove(),s.selectAll("path").remove(),s.selectAll("text").attr("alignment-baseline","middle").style("text-anchor","end").style("font-size","14px").style("font-family","Montserrat").style("font-weight","100").attr("dy","-7px").style("user-select","none").attr("transform","rotate(-90)")}}}),T=z,B=Object(O["a"])(T,M,$,!1,null,null,null),W=B.exports,E={name:"heatmap",props:["allIncidents","boxSelectedIncidents","incidentType","allSummary"],components:{Barchart:I,Stackedbar:W},data:function(){return{cellWidth:13,cellHeight:13,barHeight:25,margin:{bottom:2,top:50,left:50,right:5},legendWidth:60,legendMargin:{top:60,left:8},chart:{sizeScale:void 0},incidents:void 0,nested:void 0,years:[],months:w,hours:k,stats:{year:{min:1/0,max:-1/0,totals:void 0},month:{min:1/0,max:-1/0,totals:void 0},hour:{min:1/0,max:-1/0,totals:void 0}},selected:{hour:void 0,month:void 0,year:void 0,type:void 0,incidents:void 0}}},watch:{allIncidents:function(){var t;this.filterAndProcessIncidents(),(t=this.years).push.apply(t,Object(c["a"])(this.nested.map((function(t){return t.key})))),this.clearChart(),this.updateChart()},incidentType:function(){this.selected.hour=void 0,this.selected.month=void 0,this.selected.year=void 0,this.selected.type=void 0,this.selected.incidents=0,this.filterAndProcessIncidents(),this.clearChart(),this.updateChart()},boxSelectedIncidents:function(){}},computed:{height:function(){return this.cellHeight*this.hours.length},chartHeight:function(){return this.height+this.margin.top+this.margin.bottom},width:function(){return this.years.length*this.months.length*this.cellWidth},chartWidth:function(){return this.width+this.margin.left+this.margin.right},legendHeight:function(){return 1.5*this.cellHeight}},methods:{clearChart:function(){g["r"](this.$refs.heatmapSvg).selectAll("*").remove(),g["r"](this.$refs.heatmapLegend).selectAll("*").remove(),this.$refs.heatmap.classList.remove("heatmap__visible")},filterAndProcessIncidents:function(){var t=this,e=this.allIncidents.filter((function(e){return e.mode_type==t.incidentType||"*"==t.incidentType}));this.nested=g["l"]().key((function(t){return t.year})).key((function(t){return t.month})).sortKeys((function(t,e){return t-e})).key((function(t){return t.hour})).sortKeys((function(t,e){return t-e})).entries(e),this.nested.forEach((function(e){var a=0;e.values.forEach((function(e){var n=0;e.values.forEach((function(e){var a=e.values.length;t.stats.hour.min=Math.min(a,t.stats.hour.min),t.stats.hour.max=Math.max(a,t.stats.hour.max),e.total=a,n+=a})),e.total=n,a+=n,t.stats.month.min=Math.min(n,t.stats.month.min),t.stats.month.max=Math.max(n,t.stats.month.max)})),e.total=a,t.stats.year.min=Math.min(a,t.stats.year.min),t.stats.year.max=Math.max(a,t.stats.year.max)})),this.incidents=e;var a=k.map((function(t,e){return{key:t,hour:e,class:"hour-total hour-".concat(e),total:0}})),n=this.nested.map((function(t){return t.values.map((function(e){var n=w[+e.key];return e.values.forEach((function(t){a[+t.key].total+=t.total})),{year:t.key,month:e.key,key:"".concat(n," ").concat(t.key),class:"month-total month-".concat(e.key," year-").concat(t.key),total:e.total}}))})),i=this.nested.map((function(t){return{year:t.key,key:"".concat(t.key),class:"year-total year-".concat(t.key),total:t.total}}));this.$set(this.stats.year,"totals",i.flat()),this.$set(this.stats.month,"totals",n.flat()),this.$set(this.stats.hour,"totals",a.flat())},selectByHour:function(t){var e=this;this.selected.year=void 0,this.selected.month=void 0,this.selected.hour=t,this.selected.type="hour";var a=[];this.nested.forEach((function(t){t.values.forEach((function(t){t.values[e.selected.hour]&&a.push.apply(a,Object(c["a"])(t.values[e.selected.hour].values))}))})),this.selected.incidents=this.stats.hour.totals[t].total,this.$emit("selected",{selected:a,type:"hour"})},selectByMonth:function(t,e){this.selected.year=t,this.selected.month=+e.key,this.selected.hour=void 0,this.selected.type="month";var a=[];e.values.forEach((function(t){a.push.apply(a,Object(c["a"])(t.values))})),this.selected.incidents=a.length,this.selected.incidents=this.stats.month.totals[this.selected.month].total,this.$emit("selected",{selected:a,type:"month"})},createScale:function(){this.chart.sizeScale=g["q"]().domain([0,this.stats.hour.max]).range([0,.5*(this.cellWidth-1)])},updateChart:function(){var t=this,e=this;this.createScale();var a=g["r"](this.$refs.heatmapSvg),n=a.append("g").attr("class","heatmap--chart").attr("transform","translate(".concat(this.margin.left,",").concat(this.margin.top,")")),i=(a.append("g").attr("class","heatmap--year-labels labels"),a.append("g").attr("transform","translate(0,".concat(this.margin.top,")")).attr("class","heatmap--hour-labels labels").selectAll("text").data(this.hours).enter().append("text").attr("height",this.cellHeight).attr("width",this.cellWidth).attr("class","heatmap--hour-label labels").attr("alignment-baseline","middle").style("text-anchor","end").attr("transform",(function(e,a){var n=t.margin.left-6,i=t.cellHeight*(a+1)-t.cellHeight/2;return"translate(".concat(n,",").concat(i,")")})).style("font-weight","100").style("font-size","12px").style("text-align","left").style("fill","#aaa").text((function(t){return t})).on("click",(function(t,i){n.selectAll(".hour__selected").classed("hour__selected",!1),n.selectAll(".hour-".concat(i)).classed("hour__selected",!0),a.selectAll(".label__selected").classed("label__selected",!1),g["r"](this).classed("label__selected",!0),e.selectByHour(i)})),12*this.cellWidth/2);this.nested.forEach((function(r,s){var c=12*s*t.cellWidth,o=n.append("g").attr("class",(function(t){return"year year-".concat(r.key)})).attr("class","year").attr("transform","translate(".concat(c,",0)"));o.append("text").attr("class","heatmap--year-label label").attr("transform","translate(".concat(i,",-40)")).style("font-weight","100").style("font-size","16px").style("text-align","center").style("fill","#aaa").attr("alignment-baseline","middle").style("text-anchor","middle").text(r.key).append("title").text("Incidents from year ".concat(r.key)),o.append("rect").attr("class","heatmap--column-sep").attr("transform","translate(".concat(2*i,",-20)")).attr("width",".25").attr("height",t.height+20).style("fill","#aaa").style("opacity",.9),r.values.forEach((function(i,s){var c=s*t.cellWidth,l=o.append("g").attr("class",(function(t){return"month month-".concat(i.key)})).attr("transform","translate(".concat(c,",0)"));l.append("text").attr("class","heatmap--month-label label").attr("transform","translate(".concat(t.cellWidth/2,",").concat(-10,")")).style("font-weight","100").style("font-size","11px").attr("alignment-baseline","middle").style("text-anchor","middle").style("fill","#aaa").text(i.key).on("click",(function(t,s){n.selectAll(".hour__selected").classed("hour__selected",!1),l.selectAll(".hour").classed("hour__selected",!0),a.selectAll(".label__selected").classed("label__selected",!1),g["r"](this).classed("label__selected",!0),e.selectByMonth(r.key,i)})),i.values.forEach((function(n,s){var c=+n.key,o=n.values.length,h=Math.max(.3,o/t.stats.hour.max),d=S.scaleColor(h),u=t.chart.sizeScale(o);l.append("circle").attr("class",(function(t){return"hour hour-".concat(n.key)})).attr("cx",t.cellWidth/2).attr("cy",c*t.cellHeight+t.cellHeight/2).attr("r",u).attr("fill",d).attr("opacity",.6).attr("stroke","none").on("mouseover",(function(t,e){g["r"](this).classed("hour__hovered",!0)})).on("mouseout",(function(t,e){g["r"](this).classed("hour__hovered",!1)})).on("click",(function(t,i){a.selectAll(".label__selected").classed("label__selected",!1),a.selectAll(".hour__selected").classed("hour__selected",!1),g["r"](this).classed("hour__selected",!0),e.$emit("selected",{selected:n.values,type:"single"}),e.selected.incidents=n.values.length})).append("title").text("".concat(o," incidents at ").concat(t.hours[n.key]," in ").concat(t.months[i.key]," ").concat(r.key))}))}))})),this.updateLegend(),this.$refs.heatmap.classList.contains("heatmap__visible")||this.$refs.heatmap.classList.add("heatmap__visible")},showBoxSelectedIncidents:function(){var t=this;this.createScale();var e=g["l"]().key((function(t){return t.year})).key((function(t){return t.month})).sortKeys((function(t,e){return t-e})).key((function(t){return t.hour})).sortKeys((function(t,e){return t-e})).entries(this.boxSelectedIncidents),a=g["r"](this.$refs.heatmapSvg);a.select(".heatmap--selected").remove();var n=a.append("g").attr("class","heatmap--selected").attr("transform","translate(".concat(this.margin.left,",").concat(this.margin.top,")")),i="hsl(348, 100%, 61%)";e.forEach((function(e,a){var r=12*a*t.cellWidth,s=n.append("g").attr("class",(function(t){return"year year-".concat(e.key)})).attr("class","year").attr("transform","translate(".concat(r,",0)"));e.values.forEach((function(a,n){var r=n*t.cellWidth,c=s.append("g").attr("class",(function(t){return"month month-".concat(a.key)})).attr("transform","translate(".concat(r,",0)"));a.values.forEach((function(a,r){var s=+a.key,o=a.values.length,l=(Math.max(.3,o/t.stats.hour.max),t.chart.sizeScale(o));c.append("circle").attr("class",(function(t){return"hour hour-".concat(a.key)})).attr("cx",t.cellWidth/2).attr("cy",s*t.cellHeight+t.cellHeight/2).attr("r",l).attr("fill",i).attr("opacity",1).attr("stroke",i).append("title").text("".concat(o," incidents at ").concat(t.hours[r]," in ").concat(t.months[n]," ").concat(e.key))}))}))}))},updateLegend:function(){var t=this,e=g["o"]().domain([0,this.stats.hour.max]).nice().ticks(5);e[0]<5&&(e[0]=this.stats.hour.min);var a=g["r"](this.$refs.heatmapLegend),n=this.legendMargin.left,i=this.legendMargin.top+2.25*this.cellHeight,r=1.25*this.cellHeight,s=a.append("text").attr("class",(function(t){return"legendTitle"})).attr("x",n).attr("y",(function(e,a){return t.legendMargin.top})).style("font-weight","100").style("font-size","11px").attr("alignment-baseline","middle").style("text-anchor","left").style("fill","#aaa").text("");s.append("tspan").attr("x",n).attr("y",(function(e,a){return t.legendMargin.top})).text("# of"),s.append("tspan").attr("x",n).attr("y",(function(e,a){return t.legendMargin.top+t.cellHeight})).text("Incidents");var c=a.append("g");c.selectAll(".legendDots").data(e).enter().append("circle").attr("class",(function(t){return"legendDots legend-".concat(t)})).attr("cx",n+10).attr("cy",(function(t,e){return i+r*e})).attr("r",(function(e){return t.chart.sizeScale(e)})).attr("fill",(function(e){return S.scaleColor(Math.max(.3,e/t.stats.hour.max))})).attr("opacity",.6).attr("stroke","none"),c.selectAll(".legendLabels").data(e).enter().append("text").attr("class",(function(t){return"legendLabels legend-".concat(t)})).attr("x",n+10+this.cellWidth).attr("y",(function(t,e){return i+r*e})).style("font-weight","100").style("font-size","11px").attr("alignment-baseline","middle").style("text-anchor","left").style("fill","#aaa").attr("opacity",.6).text((function(t){return t}))}}},L=E,P=(a("77e4"),Object(O["a"])(L,x,_,!1,null,null,null)),N=P.exports,R={name:"GeoHeatmap",components:{Heatmap:N},props:["neighborhoods","stations","allIncidents","allSummary","year","month","incidentType"],data:function(){return{height:800,width:900,rightClip:200,heatmapData:void 0,projection:void 0,path:void 0,incidents:void 0,quadtree:void 0,boxSelectedIncidents:[],numBoxSelectedIncidents:0,hover:{x:0,y:0,r:10},refreshing:!1,selectedIncidents:[]}},computed:{yearRange:function(){return this.allSummary&&this.allSummary.yearly?"from ".concat(this.allSummary.yearly[0].name," to ").concat(this.allSummary.yearly[this.allSummary.yearly.length-1].name):"from 2015 to 2020"}},watch:{neighborhoods:function(){this.createMapVis()},stations:function(){},allIncidents:function(){this.convertData(),this.processAndFilterData()},incidentType:function(){this.processAndFilterData(),this.selectedIncidents=[],this.updateSelectionSvg(),this.updateSelectionCanvas(),this.updateHeatMap()},year:function(){this.updateHeatMap()},month:function(){this.updateHeatMap()},hover:{deep:!0,handler:function(){this.moveHoverBox(),this.updateHoverSelection()}},heatmapData:function(){this.updateHoverSelection()}},methods:{createMapVis:function(){this.projection=g["d"]().precision(.1).translate([this.width/2,this.height/2]).fitExtent([[0,0],[this.width,this.height]],this.neighborhoods),this.path=g["e"]().projection(this.projection);var t=g["r"](this.$refs.mapSvg);t.append("g").selectAll(".boundary").data(this.neighborhoods.features).enter().append("path").attr("class","boundary").attr("d",this.path).attr("stroke","#fff").attr("stroke-width",".2").attr("stroke-opacity",".8").style("fill","#222").attr("title",(function(t){return t.properties.NEIGHBORHOOD}));var e=t.append("rect").attr("class","hoverbox").style("transform","translate(0,0)").style("height",0).style("width",0).style("stroke","none").style("fill","#ccc").attr("x",0).attr("y",0).attr("opacity",.05),a=this;g["r"](this.$refs.mapCanvasSelection).on("mousemove",(function(){e.attr("visibility","visible");var t=g["k"](this),n=Object(y["a"])(t,2);a.hover.x=n[0],a.hover.y=n[1]})).on("mouseout",(function(){e.attr("visibility","hidden")}))},updateStations:function(){var t=g["r"](this.$refs.mapSvg);t.append("g").selectAll(".station").data(this.stations.features).enter().append("path").attr("class","station").attr("d",this.path).style("stroke","none").style("fill","#ccc").attr("opacity",.05)},convertData:function(){var t=this;this.allIncidents.forEach((function(e){var a=t.projection([e.long,e.lat]),n=Object(y["a"])(a,2);e.x=n[0],e.y=n[1]}))},processAndFilterData:function(){var t=this,e=this.allIncidents.filter((function(e){return(e.mode_type==t.incidentType||"*"==t.incidentType)&&e.id<100*t.year+t.month}));this.heatmapData=e.map((function(t){return[t.x,t.y,1]})),this.quadtree=g["m"]().x((function(t){return t.x})).y((function(t){return t.y})),this.quadtree.addAll(e),this.incidents=e},updateHeatMap:function(){this.$refs.mapvis.classList.remove("mapvis__visible"),this.processAndFilterData();var t=b()(this.$refs.mapCanvas);t.data(this.heatmapData),t.radius(1.5,2),t.gradient({1:g["g"](.3),.5:g["g"](.5),0:g["g"](1)}),t.draw(.05),this.$refs.mapvis.classList.contains("mapvis__visible")||this.$refs.mapvis.classList.add("mapvis__visible")},updateSelection:function(t){var e=t.selected,a=t.type;this.selectedIncidents=e.map((function(t){return[t.x,t.y,1]})),"single"==a?(this.updateSelectionSvg(),this.updateSelectionCanvas()):(g["r"](this.$refs.mapSvgSelection).selectAll("*").remove(),this.updateSelectionCanvas())},updateSelectionSvg:function(){var t=g["r"](this.$refs.mapSvgSelection);t.selectAll("*").remove();t.selectAll(".selected--incident").data(this.selectedIncidents).enter().append("circle").attr("class","selected--incident").attr("cx",(function(t){return t[0]})).attr("cy",(function(t){return t[1]})).attr("r",4).attr("stroke","#111").attr("stroke-width","1").style("fill","#288be4").style("opacity",1)},updateSelectionCanvas:function(){var t=b()(this.$refs.mapCanvasSelection);t.data(this.selectedIncidents),t.radius(3,0),t.gradient({1:g["f"](.75),0:g["f"](1)}),t.draw(.05)},updateHoverSelection:function(){var t=this.hover.r,e=this.hover.x-t,a=this.hover.y-t,n=[this.hover.x,this.hover.y],i=n[0],r=n[1],s=[];this.quadtree.visit((function(t,n,c,o,l){if(!t.length)do{var h=t.data,d=h.x,u=h.y,p=d>=e&&d<i&&u>=a&&u<r;p&&s.push(t.data)}while(t=t.next);return n>=i||c>=r||o<e||l<a})),this.$set(this,"boxSelectedIncidents",s),this.numBoxSelectedIncidents=s&&s.length},moveHoverBox:function(){var t=g["r"](this.$refs.mapSvg),e=this.hover,a=(e.x,e.y,e.r);this.hover.r;t.select(".hoverbox").attr("class","hoverbox").style("transform","translate(".concat(this.hover.x-a,"px,").concat(this.hover.y-a,"px)")).style("height",this.hover.r).style("width",this.hover.r).style("stroke","#fff").style("storke-opacity",1).style("fill","#288BE4").attr("opacity",.5)},updateLegend:function(){}}},F=R,q=(a("0f19"),Object(O["a"])(F,f,m,!1,null,"e617eaf2",null)),V=q.exports;function J(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function K(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?J(Object(a),!0).forEach((function(e){Object(s["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var G={name:"home",components:{GeoHeatmap:V},data:function(){return{isLoading:!0,neighborhoods:void 0,stations:void 0,incidents:void 0,incidentsSummary:{yearly:void 0,monthly:void 0,hourly:void 0},incidentType:"*",animate:!1,years:[],year:2015,month:1,updateInterval:void 0}},beforeMount:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,a,n,i,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,h.a.get(d);case 2:return a=t.sent,this.neighborhoods=Object.freeze(a.data),console.log("Retrieved Neighborhoods"),t.next=7,h.a.get(u);case 7:return a=t.sent,this.stations=Object.freeze(a.data),t.next=11,h.a.get(p);case 11:a=t.sent,n=new Set,i={},a.data.data.forEach((function(t){n.add(t.year),t.id=100*t.year+t.month,t.lat=+t.lat,t.long=+t.long,i[t.year]||(i[t.year]={year:t.year,total:0}),i[t.year][t.mode_type]=(i[t.year][t.mode_type]||0)+1,i[t.year]["total"]=(i[t.year]["total"]||0)+1})),this.incidents=Object.freeze(a.data.data),(e=this.years).push.apply(e,Object(c["a"])(n)),this.years.sort(),this.year=this.years[0],this.incidentsSummary.yearly=Object.values(i).map((function(t){return K({name:t.year},t)})),this.incidentsSummary.yearly.columns=["mv","bike","ped"],this.incidentsSummary.yearly.titles={mv:"Motor Vehicle",bike:"Bike",ped:"Pedestrian"},console.log("Retrieved Incidents Data",i),this.animate?this.updateInterval=setInterval((function(){r.updateMap()}),400):(this.year=this.years[this.years.length-1],this.month=12),this.isLoading=!1;case 25:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),watch:{},computed:{yearsTitle:function(){if(0==this.years.length)return"";var t=this.years[0],e=this.years[this.years.length-1];return"".concat(t," to ").concat(e)}},methods:{updateMap:function(){if(2019==this.year&&12==this.month)return clearInterval(this.updateInterval),void(this.updateInterval=void 0);12==this.month?(this.year=this.year+1,this.month=1):this.month++}}},U=G,Z=(a("5c0b"),Object(O["a"])(U,i,r,!1,null,null,null)),Q=Z.exports,X=a("9483");Object(X["a"])("".concat("/bvz/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});var Y=a("8c4f");n["a"].use(Y["a"]);var tt=[{path:"/",name:"geo-heatmap",component:V}],et=new Y["a"]({routes:tt}),at=et,nt=a("2f62");n["a"].use(nt["a"]);var it=new nt["a"].Store({state:{count:0},mutations:{},actions:{},modules:{}}),rt=a("289d");a("7e7d");n["a"].use(rt["a"]),n["a"].config.productionTip=!1,new n["a"]({router:at,store:it,render:function(t){return t(Q)}}).$mount("#app")},"5c0b":function(t,e,a){"use strict";var n=a("9c0c"),i=a.n(n);i.a},"6ee3":function(t,e,a){},"77e4":function(t,e,a){"use strict";var n=a("0f1a"),i=a.n(n);i.a},"7e7d":function(t,e,a){},"9c0c":function(t,e,a){},aa1c:function(t,e,a){"use strict";var n=a("6ee3"),i=a.n(n);i.a},b43f:function(t,e,a){}});
//# sourceMappingURL=app.e37ec384.js.map